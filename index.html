<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Economy Sim Lite - å›½æ°‘ã®å£° -</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;800&display=swap');

        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background-color: #1a202c;
            touch-action: manipulation;
            user-select: none;
        }

        /* ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ†ã‚£ãƒƒã‚«ãƒ¼ */
        .ticker-wrap {
            width: 100%;
            overflow: hidden;
            background-color: #000;
            color: #fbbf24;
            white-space: nowrap;
            border-top: 2px solid #fbbf24;
            border-bottom: 2px solid #fbbf24;
        }
        .ticker {
            display: inline-block;
            padding-left: 100%;
            animation: ticker 20s linear infinite;
        }
        @keyframes ticker {
            0% { transform: translate3d(0, 0, 0); }
            100% { transform: translate3d(-100%, 0, 0); }
        }

        /* ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒãƒ¼ */
        .meter-bg {
            background-color: #4a5568;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }
        .meter-fill {
            height: 100%;
            transition: width 0.5s ease-out, background-color 0.5s;
        }
        /* æ²»å®‰ã®ã€Œå±é™ºã‚¾ãƒ¼ãƒ³ã€è¡¨ç¤º */
        .danger-zone {
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            width: 20%;
            background-color: rgba(255, 0, 0, 0.3);
            z-index: 1;
        }

        /* ãƒœã‚¿ãƒ³ */
        .ctrl-btn {
            transition: all 0.2s;
        }
        .ctrl-btn:active {
            transform: scale(0.95);
        }
        .ctrl-btn.selected {
            ring: 4px;
            ring-opacity: 0.5;
            transform: translateY(-2px);
            font-weight: bold;
        }

        /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .char-img {
            transition: transform 0.3s, filter 0.3s;
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));
        }
        .anim-panic { animation: shake 0.5s infinite; }
        .anim-joy { animation: bounce 0.5s infinite alternate; }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } 100% { transform: translateX(0); } }
        @keyframes bounce { 0% { transform: translateY(0); } 100% { transform: translateY(-10px); } }

        /* èƒŒæ™¯ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆæ²»å®‰æ‚ªåŒ–æ¼”å‡ºç”¨ï¼‰ */
        #overlay-layer {
            transition: background-color 1s;
            pointer-events: none;
        }
    </style>
</head>
<body class="h-screen w-full flex items-center justify-center overflow-hidden bg-gray-900 text-gray-100">

    <div id="game-container" class="relative w-full max-w-lg h-full max-h-[850px] bg-gray-800 shadow-2xl overflow-hidden flex flex-col md:rounded-xl border-4 border-gray-600">
        
        <!-- èƒŒæ™¯ç”»åƒ -->
        <div id="game-bg" class="absolute inset-0 z-0 bg-cover bg-center transition-all duration-1000 opacity-60" 
             style="background-image: url('https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?auto=format&fit=crop&w=800&q=80');">
        </div>
        <!-- æ²»å®‰æ‚ªåŒ–æ™‚ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
        <div id="overlay-layer" class="absolute inset-0 z-0 bg-transparent"></div>

        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ï¼š3ã¤ã®æŠ½è±¡åŒ–ãƒ¡ãƒ¼ã‚¿ãƒ¼ -->
        <div class="relative z-20 bg-gray-900/90 p-4 border-b border-gray-600 shadow-lg">
            <div class="flex justify-between items-center mb-2">
                <span class="bg-blue-600 px-3 py-1 rounded text-xs font-bold" id="period-lbl">å°±ä»» 1æœŸç›®</span>
                <span class="text-xs text-gray-400">æ®‹ã‚Šä»»æœŸ: <span id="turns-left">16</span>æœŸ</span>
            </div>

            <!-- ãƒ¡ãƒ¼ã‚¿ãƒ¼ç¾¤ -->
            <div class="space-y-3">
                <!-- 1. æ”¯æŒç‡ (HP) -->
                <div class="flex items-center gap-3">
                    <div class="w-8 text-center text-xl"><i class="fas fa-heart text-pink-500"></i></div>
                    <div class="flex-grow">
                        <div class="flex justify-between text-xs mb-1 font-bold">
                            <span>å†…é–£æ”¯æŒç‡</span>
                            <span id="val-support">50%</span>
                        </div>
                        <div class="meter-bg bg-gray-700">
                            <div id="bar-support" class="meter-fill bg-pink-500" style="width: 50%"></div>
                        </div>
                    </div>
                </div>

                <!-- 2. æ™¯æ°— (Economy) -->
                <div class="flex items-center gap-3">
                    <div class="w-8 text-center text-xl" id="icon-economy"><i class="fas fa-sun text-orange-400"></i></div>
                    <div class="flex-grow">
                        <div class="flex justify-between text-xs mb-1 font-bold">
                            <span>çµŒæ¸ˆçŠ¶æ³</span>
                            <span id="text-economy" class="text-orange-400">å¥½èª¿</span>
                        </div>
                        <div class="meter-bg bg-gray-700">
                            <div id="bar-economy" class="meter-fill bg-orange-400" style="width: 60%"></div>
                        </div>
                    </div>
                </div>

                <!-- 3. æ²»å®‰/æ ¼å·® (Safety) -->
                <div class="flex items-center gap-3">
                    <div class="w-8 text-center text-xl" id="icon-safety"><i class="fas fa-shield-alt text-blue-400"></i></div>
                    <div class="flex-grow">
                        <div class="flex justify-between text-xs mb-1 font-bold">
                            <span>æ²»å®‰ãƒ¬ãƒ™ãƒ«</span>
                            <span id="text-safety" class="text-blue-400">å®‰å…¨</span>
                        </div>
                        <div class="meter-bg bg-gray-700">
                            <div class="danger-zone"></div> <!-- å³ç«¯20%ã¯æš´å‹•ãƒªã‚¹ã‚¯ -->
                            <div id="bar-safety" class="meter-fill bg-blue-500" style="width: 80%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ†ã‚£ãƒƒã‚«ãƒ¼ -->
        <div class="relative z-10 ticker-wrap h-8">
            <div class="ticker leading-8 text-sm font-bold" id="news-ticker">
                æ–°æ”¿æ¨©ç™ºè¶³ã€‚ã€Œå›½æ°‘ã®ãŸã‚ã®æ”¿æ²»ã€ã‚’æ²ã’ã‚¹ã‚¿ãƒ¼ãƒˆã€‚
            </div>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ï¼šç§˜æ›¸å®˜ã¨ç¤¾ä¼šã®æ§˜å­ -->
        <div class="flex-grow relative z-10 flex flex-col justify-end pb-4 pointer-events-none">
            <!-- ç§˜æ›¸å®˜ç”»åƒ -->
            <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiPPDde_59jmOm49ynT1scGbsqejmS4pg6I7g6_yGSLe7Gu7MgRqLURZZrC2NdoDpH8gz1Z-DPhUb4IvoAqk9JkWdg8UdZINM-unep1PYlje1DL4iJCH7AJGPhvxKtv1bjvuyxf2LvSjzLR/s800/face_smile_woman4.png" 
                 id="secretary-img" 
                 class="absolute bottom-10 right-[-20px] w-2/3 max-w-[280px] object-contain char-img">
            
            <!-- å¹ãå‡ºã— -->
            <div class="bg-white/95 text-gray-800 border-2 border-gray-400 rounded-xl p-4 shadow-xl mb-4 mx-4 self-start max-w-[70%] relative pointer-events-auto">
                <div class="absolute -bottom-2 left-6 w-4 h-4 bg-white border-r-2 border-b-2 border-gray-400 transform rotate-45"></div>
                <div class="font-bold text-gray-500 text-xs mb-1"><i class="fas fa-user-tie"></i> ç§˜æ›¸å®˜</div>
                <p id="secretary-msg" class="text-sm font-bold leading-relaxed">
                    ç·ç†ã€ä»ŠæœŸã®æ–¹é‡ã‚’æ±ºå®šã—ã¦ãã ã•ã„ã€‚<br>ä»Šã®ã¨ã“ã‚è¡—ã¯å¹³å’Œã§ã™ã€‚
                </p>
            </div>
        </div>

        <!-- æ“ä½œãƒ‘ãƒãƒ«ï¼ˆ3ã¤ã®å¤‰æ•°ï¼‰ -->
        <div class="relative z-30 bg-gray-900 border-t-4 border-gray-700 p-4">
            <div class="grid grid-cols-3 gap-2 mb-4">
                <!-- ç¨é‡‘ -->
                <div class="flex flex-col gap-2">
                    <div class="text-center text-xs font-bold text-gray-400">ç¨é‡‘</div>
                    <button onclick="setPolicy('tax', 'up')" id="btn-tax-up" class="ctrl-btn bg-gray-700 hover:bg-red-900 text-red-300 py-2 rounded text-xs border border-gray-600">å¢—ç¨</button>
                    <button onclick="setPolicy('tax', 'keep')" id="btn-tax-keep" class="ctrl-btn bg-gray-600 text-white py-2 rounded text-xs border border-gray-500 ring-2 ring-blue-400 font-bold">ç¶­æŒ</button>
                    <button onclick="setPolicy('tax', 'down')" id="btn-tax-down" class="ctrl-btn bg-gray-700 hover:bg-green-900 text-green-300 py-2 rounded text-xs border border-gray-600">æ¸›ç¨</button>
                </div>
                <!-- ç¤¾ä¼šä¿éšœ -->
                <div class="flex flex-col gap-2">
                    <div class="text-center text-xs font-bold text-gray-400">ç¤¾ä¼šä¿éšœ</div>
                    <button onclick="setPolicy('social', 'up')" id="btn-social-up" class="ctrl-btn bg-gray-700 hover:bg-green-900 text-green-300 py-2 rounded text-xs border border-gray-600">æ‰‹åšã</button>
                    <button onclick="setPolicy('social', 'keep')" id="btn-social-keep" class="ctrl-btn bg-gray-600 text-white py-2 rounded text-xs border border-gray-500 ring-2 ring-blue-400 font-bold">ç¶­æŒ</button>
                    <button onclick="setPolicy('social', 'down')" id="btn-social-down" class="ctrl-btn bg-gray-700 hover:bg-red-900 text-red-300 py-2 rounded text-xs border border-gray-600">å‰Šæ¸›</button>
                </div>
                <!-- é‡‘åˆ© -->
                <div class="flex flex-col gap-2">
                    <div class="text-center text-xs font-bold text-gray-400">é‡‘åˆ©</div>
                    <button onclick="setPolicy('rate', 'up')" id="btn-rate-up" class="ctrl-btn bg-gray-700 hover:bg-blue-900 text-blue-300 py-2 rounded text-xs border border-gray-600">ä¸Šã’ã‚‹</button>
                    <button onclick="setPolicy('rate', 'keep')" id="btn-rate-keep" class="ctrl-btn bg-gray-600 text-white py-2 rounded text-xs border border-gray-500 ring-2 ring-blue-400 font-bold">ç¶­æŒ</button>
                    <button onclick="setPolicy('rate', 'down')" id="btn-rate-down" class="ctrl-btn bg-gray-700 hover:bg-orange-900 text-orange-300 py-2 rounded text-xs border border-gray-600">ä¸‹ã’ã‚‹</button>
                </div>
            </div>

            <button onclick="executeTurn()" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-lg shadow-lg text-lg transition border-b-4 border-blue-800 active:border-0 active:translate-y-1">
                æ”¿ç­–å®Ÿè¡Œ <i class="fas fa-paper-plane ml-2"></i>
            </button>
        </div>

        <!-- çµæœå ±å‘Šãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div id="result-modal" class="hidden absolute inset-0 z-50 bg-black/80 flex items-center justify-center p-6">
            <div class="bg-white text-gray-800 rounded-xl shadow-2xl w-full max-w-sm overflow-hidden transform transition-all scale-95 opacity-0" id="result-box">
                <div class="bg-gray-800 text-white p-3 font-bold text-center border-b-4 border-gray-600">
                    <span id="result-period">ç¬¬1æœŸ</span> å ±å‘Š
                </div>
                <div class="p-6 text-center">
                    <div class="text-5xl mb-4" id="result-icon">ğŸ“¢</div>
                    <h3 class="text-xl font-bold mb-2" id="result-title">å¤‰åŒ–ãªã—</h3>
                    <p class="text-sm text-gray-600 mb-6 leading-relaxed" id="result-desc">
                        ç‰¹ã«å¤§ããªå¤‰åŒ–ã¯è¦‹ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚
                    </p>
                    <button onclick="closeResult()" class="w-full bg-gray-800 text-white font-bold py-3 rounded-lg hover:bg-gray-700">
                        æ¬¡ã¸
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç”»é¢ -->
        <div id="ending-screen" class="hidden absolute inset-0 z-50 bg-gray-900 flex flex-col items-center justify-center p-6 text-center text-white">
            <div id="end-icon" class="text-6xl mb-4">ğŸ’¥</div>
            <h2 id="end-title" class="text-4xl font-bold mb-4">æ”¿æ¨©å´©å£Š</h2>
            <p id="end-desc" class="text-gray-400 mb-8 max-w-xs mx-auto">æš´å‹•ãŒç™ºç”Ÿã—ã€å®˜é‚¸ãŒåŒ…å›²ã•ã‚Œã¾ã—ãŸã€‚</p>
            <button onclick="location.reload()" class="bg-white text-gray-900 px-8 py-3 rounded-full font-bold hover:bg-gray-200">
                æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™
            </button>
        </div>

    </div>

    <script>
        // --- è¨­å®šãƒ‡ãƒ¼ã‚¿ ---
        const images = {
            normal: "https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?auto=format&fit=crop&w=800&q=80", // ãƒ“ãƒ«è¡—
            boom: "https://images.unsplash.com/photo-1444723121867-26b5d62e1698?auto=format&fit=crop&w=800&q=80",   // è¯ã‚„ã‹
            slum: "https://images.unsplash.com/photo-1533106958148-dae5338dd895?auto=format&fit=crop&w=800&q=80",   // è·¯åœ°è£
            riot: "https://images.unsplash.com/photo-1575517111839-3a3843ee7f5d?auto=format&fit=crop&w=800&q=80"    // æ··ä¹±
        };

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ (0-100 scale)
        let state = {
            turn: 1,
            maxTurns: 16,
            
            // å†…éƒ¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ (ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯è¦‹ãˆãªã„è©³ç´°å€¤)
            gdp: 50,       // çµŒæ¸ˆè¦æ¨¡ (é«˜ã™ãã‚‹ã¨æ ¼å·®æ‹¡å¤§)
            gap: 30,       // æ ¼å·® (é«˜ã„ã¨æ²»å®‰æ‚ªåŒ–)
            inflation: 20, // ç‰©ä¾¡ (é«˜ã„ã¨æ”¯æŒç‡ä½ä¸‹)
            
            // è¡¨ç¤ºç”¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
            support: 50,   // æ”¯æŒç‡ (0ã§ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼)
            economy: 50,   // æ™¯æ°—ãƒ¡ãƒ¼ã‚¿ãƒ¼
            safety: 80,    // æ²»å®‰ãƒ¡ãƒ¼ã‚¿ãƒ¼ (ä½ã„ã¨æš´å‹•)

            // ç¾åœ¨ã®æ”¿ç­–é¸æŠ
            policy: {
                tax: 'keep',    // up, keep, down
                social: 'keep', // up, keep, down
                rate: 'keep'    // up, keep, down
            }
        };

        // DOM Elements
        const el = (id) => document.getElementById(id);
        const ui = {
            bg: el('game-bg'),
            overlay: el('overlay-layer'),
            period: el('period-lbl'),
            turnsLeft: el('turns-left'),
            supportBar: el('bar-support'),
            supportVal: el('val-support'),
            ecoBar: el('bar-economy'),
            ecoText: el('text-economy'),
            ecoIcon: el('icon-economy'),
            safeBar: el('bar-safety'),
            safeText: el('text-safety'),
            safeIcon: el('icon-safety'),
            ticker: el('news-ticker'),
            secretaryMsg: el('secretary-msg'),
            secretaryImg: el('secretary-img'),
            modal: el('result-modal'),
            resBox: el('result-box'),
            resPeriod: el('result-period'),
            resTitle: el('result-title'),
            resDesc: el('result-desc'),
            resIcon: el('result-icon'),
            endScreen: el('ending-screen'),
            endTitle: el('end-title'),
            endDesc: el('end-desc'),
            endIcon: el('end-icon')
        };

        // åˆæœŸåŒ–
        function init() {
            updateUI();
        }

        // æ”¿ç­–ãƒœã‚¿ãƒ³é¸æŠå‡¦ç†
        window.setPolicy = (type, val) => {
            state.policy[type] = val;
            
            // ãƒœã‚¿ãƒ³ã®è¦‹ãŸç›®æ›´æ–°
            const buttons = ['up', 'keep', 'down'];
            buttons.forEach(b => {
                const btn = el(`btn-${type}-${b}`);
                if (b === val) {
                    btn.classList.add('ring-2', 'ring-blue-400', 'font-bold');
                    btn.classList.remove('opacity-50');
                } else {
                    btn.classList.remove('ring-2', 'ring-blue-400', 'font-bold');
                }
            });
        };

        // ã‚¿ãƒ¼ãƒ³å®Ÿè¡Œï¼ˆãƒ­ã‚¸ãƒƒã‚¯ä¸­æ¢ï¼‰
        window.executeTurn = () => {
            // 1. æ”¿ç­–ã®å½±éŸ¿è¨ˆç®—
            let diff = { gdp: 0, gap: 0, inflation: 0, support: 0, safety: 0 };
            let msg = "";

            // ç¨é‡‘ (Tax)
            if (state.policy.tax === 'up') {
                diff.gdp -= 5;      // æ™¯æ°—å†·ãˆã‚‹
                diff.gap -= 5;      // æ ¼å·®ç¸®å°
                diff.inflation -= 2;
                diff.support -= 5;  // ä¸äººæ°—
            } else if (state.policy.tax === 'down') {
                diff.gdp += 5;      // æ™¯æ°—åˆºæ¿€
                diff.gap += 5;      // æ ¼å·®æ‹¡å¤§ (é‡‘æŒã¡å„ªé‡)
                diff.inflation += 2;
                diff.support += 5;  // äººæ°—
            }

            // ç¤¾ä¼šä¿éšœ (Social Security)
            if (state.policy.social === 'up') {
                diff.gap -= 10;     // æ ¼å·®å¤§å¹…ç¸®å°
                diff.support += 5;  // äººæ°—
                diff.gdp += 2;      // æ¶ˆè²»åˆºæ¿€
            } else if (state.policy.social === 'down') {
                diff.gap += 10;     // æ ¼å·®æ‹¡å¤§
                diff.support -= 10; // ä¸äººæ°—
                diff.safety -= 5;   // ã‚»ãƒ¼ãƒ•ãƒ†ã‚£ãƒãƒƒãƒˆæ¬ å¦‚ã§æ²»å®‰æ‚ªåŒ–
            }

            // é‡‘åˆ© (Interest Rate)
            if (state.policy.rate === 'up') {
                diff.inflation -= 5;// ã‚¤ãƒ³ãƒ•ãƒ¬æŠ‘åˆ¶
                diff.gdp -= 3;      // æ™¯æ°—å†·ãˆã‚‹
            } else if (state.policy.rate === 'down') {
                diff.inflation += 5;// ã‚¤ãƒ³ãƒ•ãƒ¬åŠ é€Ÿ
                diff.gdp += 3;      // æ™¯æ°—åˆºæ¿€
            }

            // 2. ç›¸äº’ä½œç”¨ (Feedback Loop)
            
            // æ™¯æ°—ãŒè‰¯ã™ãã‚‹ã¨æ ¼å·®ãŒåºƒãŒã‚‹ (ãƒˆãƒªã‚¯ãƒ«ãƒ€ã‚¦ãƒ³ã—ãªã„)
            if (state.gdp > 70) {
                diff.gap += 3;
                msg = "å¥½æ™¯æ°—ã«ã‚ˆã‚Šã€ä¸€éƒ¨ã®å¯Œè£•å±¤ã ã‘ãŒæ½¤ã£ã¦ã„ã¾ã™ã€‚";
            }

            // ã‚¤ãƒ³ãƒ•ãƒ¬ãŒé«˜ã„ã¨æ”¯æŒç‡ã¨æ²»å®‰ãŒä¸‹ãŒã‚‹
            if (state.inflation > 60) {
                diff.support -= 5;
                diff.safety -= 3;
                msg = "ç‰©ä¾¡é«˜é¨°ã§å›½æ°‘ã®ç”Ÿæ´»ãŒè‹¦ã—ããªã£ã¦ã„ã¾ã™ã€‚";
            }

            // æ ¼å·®ãŒå¤§ãã„ã¨æ²»å®‰ãŒæ‚ªåŒ–ã™ã‚‹
            if (state.gap > 60) {
                diff.safety -= 10;
                msg = "è²§å¯Œã®å·®ãŒæ‹¡å¤§ã—ã€çŠ¯ç½ªãŒå¢—åŠ ã—ã¦ã„ã¾ã™ã€‚";
            } else if (state.gap > 80) {
                diff.safety -= 20;
                msg = "æ ¼å·®ã¸ã®æ€’ã‚ŠãŒçˆ†ç™ºå¯¸å‰ã§ã™ï¼";
            }

            // 3. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿é©ç”¨ & ã‚¯ãƒ©ãƒ³ãƒ—
            state.gdp = clamp(state.gdp + diff.gdp + rand(-2, 2));
            state.gap = clamp(state.gap + diff.gap + rand(-1, 1));
            state.inflation = clamp(state.inflation + diff.inflation + rand(-1, 1));
            state.support = clamp(state.support + diff.support + rand(-1, 1));
            
            // æ²»å®‰ã¯æ ¼å·®ã®å½±éŸ¿ã‚’å¼·ãå—ã‘ã‚‹
            let safetyTarget = 100 - state.gap; 
            state.safety = clamp(state.safety * 0.8 + safetyTarget * 0.2 + diff.safety); // å¾ã€…ã«ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¸

            // 4. è¡¨ç¤ºãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¸ã®å¤‰æ›
            state.economy = state.gdp; // ãã®ã¾ã¾

            // çµæœè¡¨ç¤ºæº–å‚™
            showResult(msg, diff);
        };

        function clamp(val) { return Math.max(0, Math.min(100, val)); }
        function rand(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

        // çµæœãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
        function showResult(systemMsg, diff) {
            ui.modal.classList.remove('hidden');
            setTimeout(() => {
                ui.resBox.classList.remove('scale-95', 'opacity-0');
                ui.resBox.classList.add('scale-100', 'opacity-100');
            }, 50);

            ui.resPeriod.textContent = `ç¬¬${state.turn}æœŸ`;
            
            // çŠ¶æ³åˆ¤å®šã«ã‚ˆã‚‹ã‚¿ã‚¤ãƒˆãƒ«ã¨ã‚¢ã‚¤ã‚³ãƒ³
            let title = "ç¾çŠ¶ç¶­æŒ";
            let icon = "ğŸ˜";
            let desc = systemMsg || "ç‰¹ç­†ã™ã¹ãå¤‰åŒ–ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚";

            if (state.safety < 30) {
                title = "æ²»å®‰æ‚ªåŒ–ï¼"; icon = "ğŸ”¥"; desc = "æš´å‹•ã®ãƒªã‚¹ã‚¯ãŒé«˜ã¾ã£ã¦ã„ã¾ã™ï¼æ ¼å·®æ˜¯æ­£ãŒå¿…è¦ã§ã™ã€‚";
            } else if (state.economy > 80) {
                title = "ãƒãƒ–ãƒ«æ™¯æ°—"; icon = "ğŸ’¸"; desc = "æ™¯æ°—ã¯æœ€é«˜æ½®ã§ã™ãŒã€æ ¼å·®ã‚‚åºƒãŒã£ã¦ã„ã¾ã™ã€‚";
            } else if (state.economy < 20) {
                title = "æ·±åˆ»ãªä¸æ³"; icon = "ğŸ“‰"; desc = "å¤±æ¥­è€…ãŒæº¢ã‚Œã¦ã„ã¾ã™ã€‚æ™¯æ°—å¯¾ç­–ãŒå¿…è¦ã§ã™ã€‚";
            } else if (state.support > 80) {
                title = "åœ§å€’çš„æ”¯æŒ"; icon = "ğŸ’–"; desc = "å›½æ°‘ã¯ã‚ãªãŸã®æ”¿ç­–ã‚’ç†±çƒˆã«æ”¯æŒã—ã¦ã„ã¾ã™ã€‚";
            }

            ui.resTitle.textContent = title;
            ui.resIcon.textContent = icon;
            ui.resDesc.textContent = desc;
        }

        // æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã¸
        window.closeResult = () => {
            ui.resBox.classList.add('scale-95', 'opacity-0');
            setTimeout(() => ui.modal.classList.add('hidden'), 200);

            // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®š
            if (state.support <= 0) {
                endGame("è§£æ•£ç·é¸æŒ™", "æ”¯æŒç‡ä½ä¸‹ã«ã‚ˆã‚Šã€é¸æŒ™ã§å¤§æ•—ã—ã¾ã—ãŸã€‚", "ğŸ—³ï¸");
                return;
            }
            if (state.safety <= 0) {
                endGame("æš´å‹•ç™ºç”Ÿ", "æ€’ã‚Œã‚‹ç¾¤è¡†ãŒå®˜é‚¸ã«æŠ¼ã—å¯„ã›ã€æ”¿æ¨©ã¯è»¢è¦†ã—ã¾ã—ãŸã€‚", "ğŸ”¥");
                return;
            }
            if (state.turn >= state.maxTurns) {
                endGame("ä»»æœŸæº€äº†", "æ¿€å‹•ã®æ™‚ä»£ã‚’ä¹—ã‚Šè¶Šãˆã€ä»»æœŸã‚’å…¨ã†ã—ã¾ã—ãŸã€‚", "ğŸ‰");
                return;
            }

            state.turn++;
            updateUI();
        };

        // UIæ›´æ–°
        function updateUI() {
            ui.period.textContent = `ç¬¬${state.turn}æœŸ`;
            ui.turnsLeft.textContent = state.maxTurns - state.turn + 1;

            // ãƒãƒ¼æ›´æ–°
            ui.supportBar.style.width = `${state.support}%`;
            ui.supportVal.textContent = `${Math.round(state.support)}%`;

            ui.ecoBar.style.width = `${state.economy}%`;
            
            // æ²»å®‰ãƒãƒ¼ï¼ˆä½ã„ã¨å±é™ºï¼‰
            ui.safeBar.style.width = `${state.safety}%`;
            if (state.safety < 30) ui.safeBar.classList.replace('bg-blue-500', 'bg-red-600');
            else ui.safeBar.classList.replace('bg-red-600', 'bg-blue-500');

            // çŠ¶æ…‹ãƒ†ã‚­ã‚¹ãƒˆã¨ã‚¢ã‚¤ã‚³ãƒ³ã€èƒŒæ™¯ã€ãƒ‹ãƒ¥ãƒ¼ã‚¹æ›´æ–°
            updateAtmosphere();
        }

        function updateAtmosphere() {
            // æ™¯æ°—
            let ecoTxt = "æ™®é€š"; let ecoIcon = "fas fa-cloud"; let ecoColor = "text-gray-400";
            if (state.economy > 70) { ecoTxt = "å¥½æ™¯æ°—"; ecoIcon = "fas fa-sun"; ecoColor = "text-orange-400"; }
            else if (state.economy < 30) { ecoTxt = "ä¸æ³"; ecoIcon = "fas fa-snowflake"; ecoColor = "text-blue-300"; }
            ui.ecoText.textContent = ecoTxt;
            ui.ecoText.className = ecoColor;
            ui.ecoBar.className = `meter-fill ${state.economy > 70 ? 'bg-orange-400' : (state.economy < 30 ? 'bg-blue-300' : 'bg-green-500')}`;
            ui.ecoIcon.innerHTML = `<i class="${ecoIcon} ${ecoColor}"></i>`;

            // æ²»å®‰
            let safeTxt = "å®‰å…¨"; let safeColor = "text-blue-400";
            if (state.safety < 50) { safeTxt = "ä¸å®‰"; safeColor = "text-yellow-400"; }
            if (state.safety < 20) { safeTxt = "å±é™º"; safeColor = "text-red-500 animate-pulse"; }
            ui.safeText.textContent = safeTxt;
            ui.safeText.className = safeColor;
            
            // ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¨èƒŒæ™¯
            let news = "";
            let bgUrl = images.normal;
            let overlayColor = "transparent";

            if (state.safety < 30) {
                news = "ã€ç·Šæ€¥ã€‘å„åœ°ã§ãƒ‡ãƒ¢ãŒç™ºç”Ÿã€‚æ²»å®‰éƒ¨éšŠãŒå‡ºå‹•ä¸­ã€‚";
                bgUrl = images.riot;
                overlayColor = "rgba(100, 0, 0, 0.4)"; // èµ¤é»’ã„ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                ui.secretaryMsg.textContent = "ç·ç†ï¼å¤–ã‚’è¦‹ã¦ãã ã•ã„ã€æš´å‹•ã§ã™ï¼æ ¼å·®æ˜¯æ­£ã‚’æ€¥ã„ã§ãã ã•ã„ï¼";
                ui.secretaryImg.classList.add('anim-panic');
            } else if (state.economy > 80) {
                news = "æ ªä¾¡æœ€é«˜å€¤æ›´æ–°ã€‚é«˜ç´šãƒãƒ³ã‚·ãƒ§ãƒ³ãŒå³æ—¥å®Œå£²ã€‚";
                bgUrl = images.boom;
                ui.secretaryMsg.textContent = "æ™¯æ°—ã¯çµ¶å¥½èª¿ã§ã™ãŒã€æŒãŸã–ã‚‹è€…ãŸã¡ã®ä¸æº€ãŒæºœã¾ã£ã¦ã„ã¾ã™ã€‚";
                ui.secretaryImg.classList.remove('anim-panic');
            } else if (state.economy < 20) {
                news = "å¤±æ¥­ç‡ãŒæ‚ªåŒ–ã€‚ç‚Šãå‡ºã—ã«é•·è›‡ã®åˆ—ã€‚";
                bgUrl = images.slum;
                ui.secretaryMsg.textContent = "ä¸æ³ãŒæ·±åˆ»ã§ã™ã€‚æ¸›ç¨ã‚„çµ¦ä»˜é‡‘ã§å›½æ°‘ã‚’æ•‘ã£ã¦ãã ã•ã„ã€‚";
                ui.secretaryImg.classList.add('anim-panic');
            } else {
                news = "ç©ã‚„ã‹ãªæ—¥å¸¸ã€‚ç‰¹ã«å¤§ããªãƒ‹ãƒ¥ãƒ¼ã‚¹ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚";
                ui.secretaryMsg.textContent = "ä»Šã®ã¨ã“ã‚é †èª¿ã§ã™ã€‚ã“ã®ãƒãƒ©ãƒ³ã‚¹ã‚’ç¶­æŒã—ã¾ã—ã‚‡ã†ã€‚";
                ui.secretaryImg.classList.remove('anim-panic');
            }

            ui.ticker.textContent = news;
            ui.bg.style.backgroundImage = `url('${bgUrl}')`;
            ui.overlay.style.backgroundColor = overlayColor;
        }

        // ã‚²ãƒ¼ãƒ çµ‚äº†å‡¦ç†
        function endGame(title, desc, icon) {
            ui.endScreen.classList.remove('hidden');
            ui.endTitle.textContent = title;
            ui.endDesc.textContent = desc;
            ui.endIcon.textContent = icon;
        }

        // é–‹å§‹
        init();

    </script>
</body>
</html>
